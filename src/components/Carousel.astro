---
// Carousel.astro
import { Image } from 'astro:assets';

export interface Props {
  images: Array<{
    src: ImageMetadata | string;
    alt: string;
    caption?: string;
    width?: number;
    height?: number;
  }>;
  autoPlay?: boolean;
  autoPlayInterval?: number;
  showDots?: boolean;
  showArrows?: boolean;
  className?: string;
  imageWidth?: number;
  imageHeight?: number;
}

const {
  images,
  autoPlay = false,
  autoPlayInterval = 5000,
  showDots = true,
  showArrows = true,
  className = "",
  imageWidth = 1200,
  imageHeight = 600
} = Astro.props;
---

<div
  class={`relative w-full max-w-4xl mx-auto ${className}`}
  x-data={`{
    currentSlide: 0,
    totalSlides: ${images.length},
    autoPlay: ${autoPlay},
    autoPlayInterval: ${autoPlayInterval},
    intervalId: null,
    direction: 'next',
    
    init() {
      if (this.autoPlay) {
        this.startAutoPlay();
      }
    },
    
    nextSlide() {
      this.direction = 'next';
      this.currentSlide = (this.currentSlide + 1) % this.totalSlides;
    },
    
    prevSlide() {
      this.direction = 'prev';
      this.currentSlide = this.currentSlide === 0 ? this.totalSlides - 1 : this.currentSlide - 1;
    },
    
    goToSlide(index) {
      this.direction = index > this.currentSlide ? 'next' : 'prev';
      this.currentSlide = index;
    },
    
    startAutoPlay() {
      this.intervalId = setInterval(() => {
        this.nextSlide();
      }, this.autoPlayInterval);
    },
    
    stopAutoPlay() {
      if (this.intervalId) {
        clearInterval(this.intervalId);
        this.intervalId = null;
      }
    }
  }`}
  x-on:mouseenter="autoPlay && stopAutoPlay()"
  x-on:mouseleave="autoPlay && startAutoPlay()"
>
  <!-- Main carousel container -->
  <div class="relative overflow-hidden rounded-lg bg-gray-900 shadow-2xl aspect-video">
    <!-- Slides container -->
    <div class="relative w-full h-full">
      {images.map((image, index) => (
        <div
          class="absolute inset-0 w-full h-full"
          x-show={`currentSlide === ${index}`}
          x-transition:enter="transform transition-transform duration-500 ease-in-out"
          x-transition:enter-start={`direction === 'next' ? 'translate-x-full' : '-translate-x-full'`}
          x-transition:enter-end="translate-x-0"
          x-transition:leave="transform transition-transform duration-500 ease-in-out"
          x-transition:leave-start="translate-x-0"
          x-transition:leave-end={`direction === 'next' ? '-translate-x-full' : 'translate-x-full'`}
        >
          <Image
            src={image.src}
            alt={image.alt}
            width={image.width || imageWidth}
            height={image.height || imageHeight}
            class="w-full h-full object-cover"
            loading={index === 0 ? "eager" : "lazy"}
            format="webp"
            quality={85}
          />
          
          {image.caption && (
            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent p-4 md:p-6">
              <p class="text-white text-sm md:text-lg font-medium">{image.caption}</p>
            </div>
          )}
        </div>
      ))}
    </div>
    
    <!-- Navigation arrows -->
    {showArrows && (
      <>
        <!-- Previous button -->
        <button
          x-on:click="prevSlide()"
          class="absolute top-1/2 left-2 md:left-4 z-10 -translate-y-1/2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white p-2 md:p-3 rounded-full transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50"
          aria-label="Previous slide"
        >
          <svg class="w-4 h-4 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
        </button>
        
        <!-- Next button -->
        <button
          x-on:click="nextSlide()"
          class="absolute top-1/2 right-2 md:right-4 z-10 -translate-y-1/2 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white p-2 md:p-3 rounded-full transition-all duration-200 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-white/50"
          aria-label="Next slide"
        >
          <svg class="w-4 h-4 md:w-6 md:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
          </svg>
        </button>
      </>
    )}
    
    <!-- Slide counter -->
    <div class="absolute top-2 md:top-4 right-2 md:right-4 z-10 bg-black/50 backdrop-blur-sm text-white px-2 md:px-3 py-1 rounded-full text-xs md:text-sm">
      <span x-text="currentSlide + 1"></span> / <span x-text="totalSlides"></span>
    </div>
  </div>
  
  <!-- Dots indicator -->
  {showDots && (
    <div class="flex justify-center space-x-2 mt-4 md:mt-6">
      {images.map((_, index) => (
        <button
          x-on:click={`goToSlide(${index})`}
          class="w-2.5 h-2.5 md:w-3 md:h-3 rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-blue-400"
          x-bind:class={`currentSlide === ${index} ? 'bg-blue-600 scale-125' : 'bg-red-300 hover:bg-red-400'`}
          aria-label={`Go to slide ${index + 1}`}
        />
      ))}
    </div>
  )}
  
  <!-- Slide counter -->
  <div class="absolute top-4 right-4 bg-black/50 backdrop-blur-sm text-white px-3 py-1 rounded-full text-sm">
    <span x-text="currentSlide + 1"></span> / <span x-text="totalSlides"></span>
  </div>
</div>

<style>
  [x-cloak] {
    display: none !important;
  }
</style>